<!doctype html>
<html>
<head>
  	<meta charset="utf-8">
  	<title>A-Frame GUI</title>
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>

<script type="text/javascript">



function drawLabel(ctx, canvas, text, font, color) {
	ctx.font = font;
	ctx.fillStyle = color;
	ctx.textAlign = "left";
	ctx.textBaseline = 'middle';
	ctx.shadowColor = 'rgba(0,0,0,0.5)';
	ctx.shadowBlur = 8;
	ctx.shadowOffsetY = 0;
	ctx.shadowOffsetX = 0;
	ctx.scale(1, 1);
	ctx.fillText(text, canvas.height/2 - canvas.height/4, canvas.height/2, canvas.width - canvas.width/4); // position x, y 
}


AFRAME.registerComponent('gui-toggle', {
    schema: {
    	on: {default: 'click'},
//    	emit: {default:null},
		target: {type: 'selector', default: '#canvasObj'},
      	text: {type: 'string', default: 'text'},
      	fontColor: {type: 'string', default: 'black'},
      	toggleColor: {type: 'string', default: 'black'},
      	toggleOnColor: {type: 'string', default: 'green'},
      	toggleOffColor: {type: 'string', default: 'grey'},
      	backgroundColor: {type: 'string', default: 'grey'},
      	hoverColor: {type: 'string', default: 'red'},
      	width: {type: 'number', default: 2},
      	height: {type: 'number', default: 1},
      	active: {type: 'boolean', default: true}
    },
    init: function() {

        var data = this.data;
        var multiplier = 350;
        var canvasWidth = data.width*multiplier;
        var canvasHeight = data.height*multiplier;

        var el = this.el;
        var canvas = this.canvas = data.target;
        var ctx = this.ctx = canvas.getContext('2d');
		
		drawLabel(this.ctx, this.canvas, this.data.text, '100px Arial', this.data.fontColor);

		el.setAttribute('material', 'color', data.backgroundColor);
		el.setAttribute('geometry', 'width', data.width);
		el.setAttribute('geometry', 'height', data.height);

        canvas.setAttribute('width', canvasWidth);
        canvas.setAttribute('height', canvasHeight);

		this.updateToggle(data.active);
		
		el.addEventListener('mouseenter', function () {
			el.setAttribute('material', 'color', data.hoverColor);
		});
		
		el.addEventListener('mouseleave', function () {
			el.setAttribute('material', 'color', data.backgroundColor);
		});
		
		el.addEventListener(data.on, function (evt) {
			console.log('I was clicked at: ', evt.detail.intersection.point);
			document.querySelector('#togglebox').emit('toggleAnimation');
			document.querySelector('#togglehandle').emit('toggleAnimation');
		});

	},
	update: function(){
        var data = this.data;
		this.updateToggle(data.active)
	},


	updateToggle: function(active){

		if(active){

		}else{

		}

	}

});



	</script>

</head>
<body>
	<a-scene>
		<a-assets>
	        <!-- Text Canvas -->    
	        <canvas id="canvasObj" crossorigin="anonymous" webkit-playsinline=""></canvas>

		    <img id="gradient" src="assets/gradient.png">
		    <img id="ground" src="assets/ground.png">
		    <img id="panel" src="assets/settings.png">
		</a-assets>

		<a-light
			type="directional"
			color="#FFF"
			intensity="1"
			position="-1 1 2">
		</a-light>
		<a-light
			type="ambient"
			color="#444">
		</a-light>

		<a-sky src="#gradient"></a-sky>
  		<a-image position="0 -.025 0" height="300" width="300" rotation="90 0 0" src="#ground" repeat="300 300" material="color:#fff"></a-image>


		<a-camera>
			<a-cursor></a-cursor>
		</a-camera>

		<a-entity
			geometry="primitive: plane;" 

			gui-toggle="
				target:#canvasObj; 
				text:label copy; 
				width:3;
				height:1;
			" 
			material="shader: flat; transparent: true; opacity: 1; side:double;"
			opacity="1" 
			scale="1 1 1"
			position="0 1.5 -1.5" rotation="0 0 0" 
		>

			<a-entity id="text"
				material="shader: flat; src: #canvasObj; transparent: false; opacity: 1; side:double;"
				geometry="primitive: plane; width: 2.25; height: 1" 
				opacity="1" 
				scale="1 1 1"
				position="0.75 0 0.002" 
			></a-entity>

			<a-box id="togglebox" width="0.75" height="0.5" depth="0.01" material="color:white" position="-1 0 0"> 
				<a-animation begin="toggleAnimation" direction="alternate" attribute="material.color" from="white" to="green" dur="500" easing="ease-in-out-cubic"></a-animation>
				<a-box id="togglehandle" width="0.15" height="0.45" depth="0.02" material="color:grey"  position="-0.25 0 0">
					<a-animation begin="toggleAnimation" direction="alternate" attribute="position" from="-0.25 0 0" to="0.25 0 0" dur="500" easing="ease-in-out-cubic"></a-animation>
				</a-box>
			</a-box>

		</a-entity>


	</a-scene>

	

</body>