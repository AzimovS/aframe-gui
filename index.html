<!doctype html>
<html>
<head>
  	<meta charset="utf-8">
  	<title>A-Frame GUI</title>
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
</head>
<body>
	<a-scene>
		<a-assets>
	        <!-- Text Canvas -->    
	        <canvas id="canvasObjBack" crossorigin="anonymous" webkit-playsinline=""></canvas>
	        <canvas id="canvasObjFront" crossorigin="anonymous" webkit-playsinline=""></canvas>

		    <img id="gradient" src="assets/gradient.png">
		    <img id="ground" src="assets/ground.png">
		    <img id="panel" src="assets/settings.png">
		</a-assets>

		<a-light
			type="directional"
			color="#FFF"
			intensity="1"
			position="-1 1 2">
		</a-light>
		<a-light
			type="ambient"
			color="#444">
		</a-light>

		<a-sky src="#gradient"></a-sky>
  		<a-image position="0 -.025 0" height="300" width="300" rotation="90 0 0" src="#ground" repeat="300 300" material="color:#fff"></a-image>

		<a-entity camera="userHeight: 1.6" look-controls>
		  <a-entity cursor="fuse: true; fuseTimeout: 500"
		            position="0 0 -1"
		            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
		            material="color: black; shader: flat">
		  </a-entity>
		</a-entity>


		<a-entity 
			geometry="primitive: plane;" 

			gui-button="
				targetBg:#canvasObjBack; 
				targetFg:#canvasObjFront; 
				text:label copy; 
				fontColor:#f00; 
				backgroundColor:blue; 
				borderColor:#00f;
				width:3;
				height:1;
			" 
			material="shader: flat; transparent: true; opacity: 1; side:double;"
			opacity="1" 
			scale="1 1 1"
			position="0 1.5 -1.5" rotation="0 0 0" 
		>
			<a-entity id="bg"
				material="shader: flat; src: #canvasObjBack; transparent: true; opacity: 1; side:double;"
				geometry="primitive: plane; width: 3; height: 1"
				opacity="1"  
				scale="1 1 1"
				position="0 0 0.001"
			></a-entity>

			<a-entity id="text"
				material="shader: flat; src: #canvasObjFront; transparent: true; opacity: 1; side:double;"
				geometry="primitive: plane; width: 3; height: 1" 
				opacity="1" 
				scale="1 1 1"
				position="0 0 0.002" 
			></a-entity>
		</a-entity>


	</a-scene>

	<script type="text/javascript">




function roundedOutline(ctx, x, y, width, height, radius, color) {
	ctx.beginPath();
	ctx.moveTo(x, y + radius);
	ctx.lineTo(x, y + height - radius);
	ctx.arcTo(x, y + height, x + radius, y + height, radius);
	ctx.lineTo(x + width - radius, y + height);
	ctx.arcTo(x + width, y + height, x + width, y + height-radius, radius);
	ctx.lineTo(x + width, y + radius);
	ctx.arcTo(x + width, y, x + width - radius, y, radius);
	ctx.lineTo(x + radius, y);
	ctx.arcTo(x, y, x, y + radius, radius);
	ctx.strokeStyle = color;
	ctx.stroke();
}

function roundedRect(ctx, x, y, width, height, radius, color) {
	ctx.beginPath();
	ctx.moveTo(x, y + radius);
	ctx.lineTo(x, y + height - radius);
	ctx.arcTo(x, y + height, x + radius, y + height, radius);
	ctx.lineTo(x + width - radius, y + height);
	ctx.arcTo(x + width, y + height, x + width, y + height-radius, radius);
	ctx.lineTo(x + width, y + radius);
	ctx.arcTo(x + width, y, x + width - radius, y, radius);
	ctx.lineTo(x + radius, y);
	ctx.arcTo(x, y, x, y + radius, radius);
	ctx.fillStyle = color;
	ctx.fill();
}

function drawText(ctx, canvas, text, font, color, size) {
	ctx.font = font;
	ctx.fillStyle = color;
	ctx.textAlign = "center";
	ctx.textBaseline = 'middle';
	ctx.shadowColor = 'rgba(0,0,0,0.5)';
	ctx.shadowBlur = 8;
	ctx.shadowOffsetY = 0;
	ctx.shadowOffsetX = 0;
	ctx.scale(1, 1);
	ctx.fillText(text, canvas.width/2, canvas.height/2); // position x, y 

}



AFRAME.registerComponent('gui-button', {
    schema: {
    	on: {default: 'click'},
//    	emit: {default:null},
		targetFg: {type: 'selector', default: '#canvasObjFront'},
		targetBg: {type: 'selector', default: '#canvasObjBack'},
      	text: {type: 'string', default: 'text'},
      	fontColor: {type: 'string', default: 'rgba(0,0,0,1)'},
      	borderColor: {type: 'string', default: 'rgba(0,0,0,1)'},
      	backgroundColor: {type: 'string', default: 'rgba(215,215,215,1)'},
      	hoverColor: {type: 'string', default: 'rgba(122,122,122,1)'},
      	width: {type: 'number', default: 2},
      	height: {type: 'number', default: 1}
    },
    init: function() {

        var data = this.data;
        var multiplier = 350;
        var canvasWidth = data.width*multiplier;
        var canvasHeight = data.height*multiplier;

        var el = this.el;
        var canvasFg = this.canvasFg = data.targetFg;
        var canvasBg = this.canvasBg = data.targetBg;
        var ctxFg = this.ctxFg = canvasFg.getContext('2d');
        var ctxBg = this.ctxBg = canvasBg.getContext('2d');

		el.setAttribute('material', 'color', data.backgroundColor);
		el.setAttribute('geometry', 'width', data.width);
		el.setAttribute('geometry', 'height', data.height);

        canvasBg.setAttribute('width', canvasWidth);
        canvasBg.setAttribute('height', canvasHeight);

        canvasFg.setAttribute('width', canvasWidth);
        canvasFg.setAttribute('height', canvasHeight);

		roundedOutline(ctxBg, 10, 10, canvasBg.width - 20, canvasBg.height - 20, 5, data.borderColor);
		roundedRect(ctxBg, 20, 20, canvasBg.width - 40, canvasBg.height - 40, 10, data.backgroundColor);
		drawText(ctxFg, canvasFg, data.text, '100px Arial', data.fontColor, 1);
		
		el.addEventListener('mouseenter', function () {
			el.setAttribute('material', 'color', data.hoverColor);
		});
		
		el.addEventListener('mouseleave', function () {
			el.setAttribute('material', 'color', data.backgroundColor);
		});
		
		el.addEventListener(data.on, function (evt) {
			this.setAttribute('material', 'color', data.fontColor);
			console.log('I was clicked at: ', evt.detail.intersection.point);
		});

	}
});


		AFRAME.registerComponent('button-text', {
		    schema: {
		      targetFg: {type: 'selector', default: '#canvasObjFront'},
		      targetBg: {type: 'selector', default: '#canvasObjBack'},
		      text: {type: 'string', default: 'button'},
		      fontColor: {type: 'string', default: 'rgba(0,0,0,1)'},
		      borderColor: {type: 'string', default: 'rgba(0,0,0,1)'},
		      backgroundColor: {type: 'string', default: 'rgba(215,215,215,1)'},
		      width: {type: 'number', default: 1},
		      height: {type: 'number', default: 1}
		    },
		    init: function() {
		        var data = this.data;
		        var el = this.el;
		        var canvasFg = this.canvasFg = data.targetFg;
		        var canvasBg = this.canvasBg = data.targetBg;
		        var ctxFg = this.ctxFg = canvasFg.getContext('2d');
		        var ctxBg = this.ctxBg = canvasBg.getContext('2d');
		        var textLayer = document.getElementById('canvasObjFront');

				roundedOutline(ctxBg, 10, 10, canvasBg.width - 20, canvasBg.height - 20, 5, data.borderColor);
				roundedRect(ctxBg, 20, 20, canvasBg.width - 40, canvasBg.height - 40, 10, data.backgroundColor);
				drawText(ctxFg, canvasFg, data.text, '100px Arial', data.fontColor, 1);


		    },
		    update: function () {
		        // var data = this.data;
		        // var canvas = this.canvas = data.target;
		        // var ctx = this.ctx = canvas.getContext('2d');
		        // ctx.clearRect(0, 0, canvas.width, canvas.height);
		        // ctx.fillText(data.text, canvas.width/2, canvas.height/2); // position x, y 
		    }
		});
	</script>

</body>